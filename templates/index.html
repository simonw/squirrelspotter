{% extends "base.html" %}

{% block extra_head %}
{% if user %}
<script>
jQuery(function($) {
	var button_shown = false;
	function success(position) {
		$('input[name="latitude"]').val(position.coords.latitude);
		$('input[name="longitude"]').val(position.coords.longitude);
		$('input[name="coords_json"]').val(JSON.stringify(position.coords));
		if (!button_shown) {
			button_shown = true;
			$('#spotted_button').show();
			$('#locating').hide();
		}
	}
	function error(msg) {
	    $('#locating').html(msg);
	}
	if (navigator.geolocation) {
	    navigator.geolocation.getCurrentPosition(success, error);
	} else {
	    $('#locating').html('Geolocation not supported, sorry!');
	}
});
</script>
{% endif %}
{% endblock %}

{% block content %}

{% if not user %}
	<div id="login-flow">
		<h1>Squirrel spotter!</h1>
		<!-- <fb:login-button perms="email,publish_actions" show-faces="true"></fb:login-button -->
		<p><a href="/login/"><img src="http://www.bebo.com/img/facebook-login.png"></a></p>
		
	</div>
{% else %}
	<form id="spotted_form" action="/spotted/" method="POST">{% csrf_token %}
		<p id="spotted_button" style="display:none"><input type="image" src="//squirrelspotter-assets.s3.amazonaws.com/2012/i-saw-a-squirrel.png">
			<input type="hidden" name="latitude">
			<input type="hidden" name="longitude">
			<input type="hidden" name="coords_json">
		</p>
		<p id="locating">Locating...</p>
	</form>
	{% if not user.phone_number %}
		<p>Text <strong>{{ user.phone_number_token }}</strong> to <a href="tel:+442033221149">+44 203 322 1149</a> to register your number and you'll be able to report squirrels by text message!</p>
	{% else %}
		<p>Or text <a href="tel:+442033221149">+44 203 322 1149</a> and tell us where you saw the squirrel!</p>
	{% endif %}
{% endif %}

{% endblock %}
